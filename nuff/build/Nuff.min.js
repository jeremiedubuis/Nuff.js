var Nuff=function(){var a,b={models:[]},c=b.ajax=function(a){var b=a.method.toUpperCase()||"GET",c=a.url,d=a.onSuccess||function(){},e=a.onFailure||function(){};"GET"===b&&a.data&&(c=c+"?"+a.data,delete a.data);var f=new XMLHttpRequest;f.open(b,c,!0),a.contentType&&f.setRequestHeader("Content-type",a.contentType),f.onreadystatechange=function(){if(4==f.readyState){if(200!=f.status)e(f);else if(200==f.status)return d(f,JSON.parse(f.responseText)),!0;return!1}},f.send(a.data)},d=b.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]},e=(b.proxy=function(a,b){var c=[].slice.call(arguments,2);return function(){return a.apply(b||this,c.concat([].slice.call(arguments)))}},function(){return a?a:(this.regex={alphanumeric:/^[a-zA-Z0-9áàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ._\s-]+$/,numeric:/^\d+$/,alpha:/^[a-zA-ZÁÀÂÃÄÉÈËÍÌÎÏÓÒÔÚÙáàãâéèíìîóòúùûü]+$/,email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/},void(a=this))});e.prototype={set:function(a){for(var b in a)if(!a[b]instanceof RegExp)return!1;return d(this.regex,a),this},validate:function(a,b){if(this.regex[a])return this.regex[a].test(b);if(a instanceof RegExp)return a.test(b);throw new Error("Validator->validate() requires a regex of a valid check type as parameter and a value")}},b.Validator=e;var f,g=function(){return f?f:(this.actions=[],void(f=this))};g.prototype={register:function(a,b){if("function"!=typeof b)throw new Error("Dispatcher-> register() requires both string and callback");this.actions[a]?this.actions[a].push(b):this.actions[a]=[b]},unregister:function(a,b){if(!this.actions[a])throw new Error("Dispatcher->"+a+" is undefined");b||(this.actions[a]=[]);var c=this.actions[a].indexOf(b);c>-1&&this.actions[a].splice(c,1)},dispatch:function(a){this.actions[a]&&this.actions[a].forEach(function(a){"function"==typeof a&&a()})},list:function(a){console.log("Dispatcher->"+a+"-> Callbacks :"),this.actions[a].forEach(function(a){console.log(a)})}},b.Dispatcher=g;var h=function(a){f||new g,f.dispatch(a)},i=function(a,b){return f||(f=new g),this._actions[a]||(this._actions[a]=[]),this._actions[a].push(b),f.register(a,b),this},j=function(){if(f){for(_key in this._actions)this._actions[_key].forEach(function(a){f.unregister(_key,a)});return!0}return!1},k=function(){this.routes=[],this.eventListeners=[]};k.prototype={register:function(a,b,c,d){if(a&&"function"==typeof b){if(this.routes[a])throw new Error("Router-register() "+a+" route is already defined");return this.routes[a]={callback:b,scope:c||this},d&&this.listen(a),this}throw new Error("Router->register() requires a string and a callback function")},listen:function(a){var b=this,c=a.split("/").shift();this.eventListeners.push(function(){var a=window.location.hash.replace("#","");a.split("/").shift()===c&&b.setRoute(a)});var d=this.eventListeners.length-1;this.routes[c].listenerIndex=d,window.addEventListener("hashchange",this.eventListeners[d])},removeListener:function(a){var b=this.routes[a].listenerIndex;window.removeEventListener("hashchange",this.eventListeners[b]),this.eventListeners.splice(b,1)},unregister:function(a){return delete this.routes[a],this},setRoute:function(a,b){window.location.hash=a;var c=a.split("/");if(a=c[0],this.routes[a])return b||this.routes[a].callback.apply(this.routes[a].scope,c),this;throw new Error("Router->setRoute() "+a+" is undefined")}},b.Router=k;var l=function(f,g){var k=function(a){for(var b in g)"function"==typeof g[b]?k.prototype[b]=g[b]:k[b]=g[b];this._name=f,this._actions={},this.attributes={},this.set(a),this.init()};return k.prototype={init:function(){},set:function(a){return"object"==typeof a?d(this.attributes,a):"string"==typeof a&&arguments.length>1&&(this.attributes[a]=arguments[1]),this.attributes},get:function(a){return a?this.attributes[a]:this.attributes},has:function(a){return"undefined"!=typeof this.attributes[a]},attributeIs:function(b,c){return a||(a=new e),a.validate(c,this.attributes[b])},request:function(a){return c(a),this},destroy:function(){j()},dispatch:h,onDispatch:i},b.models[f]=k,k};b.Model=l;var m=(b.Collection=function(a){var c=function(){if(!a.model||!b.models[a.model])throw new Error("Collection->model must be a valid Nuff.Model");var c=new Array;d(c,a);var e=function(a,b,d){for(var e=[],f=0,g=c.length;g>f;++f)c[f].attributes[a]===b&&e.push(d?c[f]:f);return e},f={push:function(){for(var c=0,d=arguments.length;d>c;++c)if(!arguments[c]instanceof b.models[a.model])throw new Error("Collection->push must provide valid Nuff.Models");return Array.prototype.push.apply(this,arguments)},sortBy:function(a,b){return c[0]?("string"==typeof c[0].attributes[a]?c.sort(function(b,c){return b.attributes[a]<c.attributes[a]?-1:b.attributes[a]>c.attributes[a]?1:0}):parseInt(c[0].attributes[a])&&c.sort(function(b,c){return b.attributes[a]-c.attributes[a]}),"<"===b?this:c.reverse()):this},getWhere:function(a,b){return e(a,b,!0)},setWhere:function(a,b,c,d){"undefined"==typeof d&&(d=c,c=a);var f=e(a,b,!0);return f.forEach(function(a){a.set(c,d)}),f},deleteWhere:function(a,b){return"index"===a?(c[b].destroy(),c.splice(b,1)):e(a,b).forEach(function(a){c[a].destroy(),c.splice(a,1)}),this},toJSON:function(){var a=[];return c.forEach(function(b){a.push(b.get())}),a},dispatch:h,onDispatch:i};return d(c,f),a.values&&c.push.apply(this,a.values),c};return c},function(a){var b=function(c){for(var d in a)"function"==typeof a[d]?b.prototype[d]=a[d]:b[d]=a[d];this._actions={},"object"==typeof c&&c.presenterMethods&&this.mapViewFunctions(c,c.presenterMethods,c.presenterMethodsScope||this),this.init(c)};return b.prototype={init:function(a){},mapViewFunctions:function(a,b,c){var d=this;return b.forEach(function(b){if("function"!=typeof d[b])throw new Error("Presenter->mapViewFunctions() requires an array of functions associated with a view, "+b+" is not a valid method of presenter instance");a[b]=c?d[b].bind(c):d[b]}),a},destroy:function(){return j()},dispatch:h,onDispatch:i},b});return b.Presenter=m,b}();